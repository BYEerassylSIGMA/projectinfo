<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Текстовый редактор с Pyodide</title>
    <script src="https://cdn.jsdelivr.net/npm/pyodide@0.23.4/pyodide.js"></script>
</head>
<body>
    <h1>Редактор текста с Pyodide</h1>
    
    <!-- Форма для ввода слова -->
    <form id="wordForm">
        <label for="wordInput">Введите слово:</label>
        <input type="text" id="wordInput" required>
        <button type="submit">Обновить текст</button>
    </form>
    
    <!-- Отображение исходного текста -->
    <h2>Текущий текст:</h2>
    <div id="originalText" style="white-space: pre-wrap;"></div>
    
    <div id="result"></div>

    <script>
        // Загружаем Pyodide
        async function loadPyodideAndRun() {
            await loadPyodide();  // Загружаем Pyodide
        }

        loadPyodideAndRun();

        // URL вашего файла на GitHub (замените на реальный путь к файлу)
        const fileUrl = 'https://raw.githubusercontent.com/ваш_пользователь/ваш_репозиторий/main/text.txt';

        // Функция для загрузки текста с GitHub
        async function fetchTextFromGitHub() {
            const response = await fetch(fileUrl);
            if (response.ok) {
                const text = await response.text();
                document.getElementById('originalText').innerText = text;
                return text;
            } else {
                console.error('Ошибка при загрузке файла с GitHub');
                return '';
            }
        }

        // Функция для обновления текста с использованием Python в Pyodide
        async function updateText(text, word) {
            const pythonCode = `
import re
def update_text(text, word):
    if word in text:
        updated_text = re.sub(rf'({re.escape(word)})', r'$$\1$$', text)
        return updated_text
    else:
        return text
update_text('${text}', '${word}')
            `;
            const updatedText = await pyodide.runPython(pythonCode);  // Запуск Python-кода через Pyodide

            return updatedText;
        }

        // Обработка отправки формы
        document.getElementById('wordForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const word = document.getElementById('wordInput').value;  // Получаем введённое слово
            const text = await fetchTextFromGitHub();  // Загружаем текст с GitHub
            const updatedText = await updateText(text, word);  // Обновляем текст с использованием Pyodide

            document.getElementById('result').innerText = updatedText;  // Выводим обновленный текст
        });
    </script>
</body>
</html>
